<!DOCTYPE html><html lang="en"> <head> <title>three.ar.js - Graffiti</title> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, user-scalable=no,
  minimum-scale=1.0, maximum-scale=1.0"> <style>body{font-family:monospace;margin:0;overflow:hidden;position:fixed;width:100%;height:100vh;-webkit-user-select:none;user-select:none}#info{position:absolute;left:50%;bottom:0;transform:translate(-50%);margin:1em;z-index:10;display:block;line-height:2em;text-align:center;background-color:hsla(0,0%,100%,.5)}#info *{color:#fff}.title{background-color:rgba(40,40,40,.4)}.links,.title{padding:.4em .6em;border-radius:.1em}.links{background-color:rgba(40,40,40,.6)}canvas{position:absolute;top:0;left:0}.dg.ac{z-index:1!important}</style> </head> <body> <div id="info"> <span class="title">Touch and hold to draw. Shake to undo.</span><br> <span class="links"> <a href="https://github.com/google-ar/three.ar.js">three.ar.js</a> - <a href="https://developers.google.com/ar/develop/web/getting-started#examples">examples</a> </span> </div> <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/89/three.min.js"></script> <script src="https://google-ar.github.io/three.ar.js/third_party/three.js/VRControls.js"></script> <script src="https://cdn.jsdelivr.net/npm/three.ar.js@latest/dist/three.ar.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.2/dat.gui.min.js"></script> <script src="https://unpkg.com/three.meshline@1.0.3/src/THREE.MeshLine.js"></script> <script id="fragmentShader" type="shader">
precision mediump float;
precision mediump int;

varying vec3 vPosition;
varying vec3 vNormal;
varying vec2 vUv;
varying vec3 vVelocity;

void main()	{
  vec2 uv = vUv;
  uv *= 2.0;
  uv -= 1.0;
  float aa = 1.0 - abs( uv.y );
  aa = smoothstep( 0.0, 0.05, aa );
  gl_FragColor = vec4( vNormal, aa );
}
</script> <script id="vertexShader" type="shader">
  uniform mat4 modelViewMatrix;
  uniform mat4 projectionMatrix;
  uniform mat3 normalMatrix;

  attribute vec3 position;
  attribute vec3 normal;
  attribute vec2 uv;
  attribute vec3 velocity;

  varying vec3 vPosition;
  varying vec3 vNormal;
  varying vec2 vUv;
  varying vec3 vVelocity;

  void main()
  {
      vPosition = position;
      vNormal = normal;
      vUv = uv;
      vVelocity = velocity;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }

</script>  <script src="/wasm-brush.ad659a86.js"></script> <script>var vrDisplay,vrControls,arView,canvas,camera,scene,renderer,wasm={};let drawMode="TriangleStripDrawMode",btnPrefix="drawMode: ",btn=document.createElement("button");btn.style.fontFamily="monospace",btn.style.fontSize="2em",btn.style.backgroundColor="#2EAFAC",btn.style.border="1px solid black",btn.style.position="absolute",btn.style.top=0,btn.style.right=0,btn.style.zIndex=1,btn.innerText=`${btnPrefix}${drawMode}`,btn.onclick=(e=>{drawMode="TriangleStripDrawMode"==drawMode?"TrianglesDrawMode":"TriangleStripDrawMode",btn.innerText=`${btnPrefix}${drawMode}`});var guiData={drawSpheres:!1},gui=new dat.GUI;const keys=Object.keys(guiData);for(let e in keys)gui.add(guiData,keys[e]);let touchOffsetInfo={x:0,y:0};function getRandomArbitrary(e,t){return Math.random()*(t-e)+e}let particles=[];class Particle{constructor(e=new THREE.Vector3(0,0,0)){this.vx=5e-5*getRandomArbitrary(-1,1),this.vy=5e-5*getRandomArbitrary(-2,2),this.alpha=255;let t=new THREE.BoxGeometry(1,1,1),r=new THREE.MeshBasicMaterial({color:3059628,transparent:!0}),o=new THREE.Mesh(t,r);o.scale.multiplyScalar(.005),o.position.add(e.clone()),this.cube=o,scene.add(o)}finished(){return this.alpha<0}update(){this.cube.position.x=wasm.add(this.vx,this.cube.position.x),this.cube.position.y=wasm.add(this.vy,this.cube.position.y),this.alpha=wasm.subtract(this.alpha,.5),this.cube.rotation.x=wasm.add(this.cube.rotation.x,.1),this.cube.rotation.y=wasm.add(this.cube.rotation.y,.1),this.cube.material.opacity=wasm.multiply(this.alpha,.00392156863)}}function updateAllParticles(e=new THREE.Vector3(0,0,0)){if(drawing){let t=new Particle(e);particles.push(t)}for(let e=particles.length-1;e>=0;e--)particles[e].update(),particles[e].finished()&&(scene.remove(particles[e]),console.log("removed??",particles.length,scene.children.length),particles.splice(e,1))}var brush,MINIMIM_POINT_DISTANCE=.001,MINIMUM_STROKE_POINTS=2,MINIMUM_BRUSH_POINTS=2,STROKE_DISTANCE=.1,STROKE_WIDTH_EASING=.05,STROKE_WIDTH_MINIMUM=.00125,STROKE_WIDTH_MAXIMUM=.1,STROKE_WIDTH_MODIFIER=1.25,STROKE_POSITION_EASING=.5,STROKE_VELOCITY_EASING=.5,STROKE_ORTHOGONAL_EASING=.5,STROKE_NORMAL_EASING=.95,STROKE_NORMAL_QUAT_EASING=.5,MINIMIM_ERASE_ENERGY=.005,MINIMIM_ERASE_ENERGY_FRAMES=15,drawing=!1,stroke=[],strokes=[],strokeIndex=0,dots=[],brushStroke=[],drawMaterial=new THREE.RawShaderMaterial({vertexShader:document.getElementById("vertexShader").textContent,fragmentShader:document.getElementById("fragmentShader").textContent,side:THREE.DoubleSide,transparent:!0});function init(){(renderer=new THREE.WebGLRenderer({alpha:!0})).setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),renderer.autoClear=!1,canvas=renderer.domElement,document.body.appendChild(canvas),scene=new THREE.Scene,arView=new THREE.ARView(vrDisplay,renderer),camera=new THREE.ARPerspectiveCamera(vrDisplay,60,window.innerWidth/window.innerHeight,.01,100),vrControls=new THREE.VRControls(camera),window.addEventListener("resize",onWindowResize,!1),renderer.domElement.addEventListener("touchstart",function(e){drawing=!0}),renderer.domElement.addEventListener("touchend",function(e){drawing=!1,stroke.length=0,strokeIndex+=1}),renderer.domElement.addEventListener("touchmove",function(e){touchOffsetInfo={x:e.changedTouches[0].pageX/document.body.clientWidth,y:e.changedTouches[0].pageY/document.body.clientHeight},document.querySelector("#info").innerHTML=`${touchOffsetInfo.x} \n ${touchOffsetInfo.y}`});var e=new THREE.PointLight(16711680,1,100);e.position.set(0,0,0),scene.add(e),update()}THREE.ARUtils.getARDisplay().then(function(e){e?(vrDisplay=e,init()):THREE.ARUtils.displayUnsupportedMessage()});var getDrawPoint=function(){var e=new THREE.Vector3(0,0,-1).multiplyScalar(STROKE_DISTANCE),t=new THREE.Vector3,r=new THREE.Vector3;new THREE.Vector3;return function(o){o.copy(camera.position),t.copy(e),t.applyQuaternion(camera.quaternion),o.add(t);var n=new THREE.Vector3(1,0).multiplyScalar(touchOffsetInfo.x);new THREE.Vector3(0,1,0).multiplyScalar(touchOffsetInfo.y);r.copy(n),r.applyQuaternion(camera.quaternion)}}(),strokeWidth=STROKE_WIDTH_MINIMUM,position=new THREE.Vector3,previousPosition=new THREE.Vector3,normalQuat=new THREE.Quaternion,previousNormalQuat=new THREE.Quaternion,normal=new THREE.Vector3(0,0,1),previousNormal=new THREE.Vector3(0,0,1),velocity=new THREE.Vector3,previousVelocity=new THREE.Vector3,acceleration=new THREE.Vector3,accelerationArray=[];function getStroke(){return{position:new THREE.Vector3(position.x,position.y,position.z),normal:new THREE.Vector3(normal.x,normal.y,normal.z),velocity:new THREE.Vector3(velocity.x,velocity.y,velocity.z),width:strokeWidth}}const threeObjBaseScale=.0025;function makeAdot(e){var t=new THREE.OctahedronGeometry(2,1),r=new THREE.MeshToonMaterial({wireframe:guiData.isWireframe}),o=new THREE.Mesh(t,r);o.position.set(e.position.x,e.position.y,e.position.z);const n=getStroke();let a=1;return guiData.applyVelocityMult&&(a=100*n.velocity.manhattanLength()),o.scale.set(threeObjBaseScale*a,threeObjBaseScale*a,threeObjBaseScale*a),o}function processAllDots(){for(let e=0;e<dots.length;++e){dots[e]}}function processDraw(){if(guiData.drawSpheres){let e=makeAdot(getStroke());dots.push(e),scene.add(e)}if(!(stroke.length<MINIMUM_STROKE_POINTS)){var e=stroke[stroke.length-2],t=stroke[stroke.length-1];e.position.distanceTo(t.position)<MINIMIM_POINT_DISTANCE?stroke.pop():(strokes[strokeIndex]&&scene.remove(strokes[strokeIndex]),strokes[strokeIndex]=generateStroke(stroke),scene.add(strokes[strokeIndex]))}}function processDrawBrush(){if(brushStroke.push(getStroke()),!(brushStroke.length<MINIMUM_BRUSH_POINTS)){brush&&(brushStroke.shift(),scene.remove(brush));var e=brushStroke[brushStroke.length-2],t=brushStroke[brushStroke.length-1];e.position.distanceTo(t.position)<MINIMIM_POINT_DISTANCE||(brush=generateStroke(brushStroke),scene.add(brush))}}function generateStroke(e){for(var t,r=new Float32Array(2*e.length*3),o=new Float32Array(2*e.length*3),n=new Float32Array(2*e.length*2),a=new Float32Array(2*e.length*3),i=new THREE.Vector3,s=new THREE.Vector3,c=new THREE.Vector3,l=!1,d=0;d<e.length;d++){var E=e[d];if(i.crossVectors(E.normal,E.velocity),i.normalize(),i.multiplyScalar(E.width),t)t.dot(E.velocity)<0&&(l=!l);else t=new THREE.Vector3;t.copy(E.velocity),l?(s.addVectors(E.position,i),c.subVectors(E.position,i)):(s.subVectors(E.position,i),c.addVectors(E.position,i));var u=2*d*3;r[u]=s.x,r[u+1]=s.y,r[u+2]=s.z,r[u+3]=c.x,r[u+4]=c.y,r[u+5]=c.z,o[u=2*d*3]=E.normal.x,o[u+1]=E.normal.y,o[u+2]=E.normal.z,o[u+3]=E.normal.x,o[u+4]=E.normal.y,o[u+5]=E.normal.z,a[u=2*d*3]=E.velocity.x,a[u+1]=E.velocity.y,a[u+2]=E.velocity.z,a[u+3]=E.velocity.x,a[u+4]=E.velocity.y,a[u+5]=E.velocity.z,n[u=2*d*2]=d/(e.length-1),n[u+1]=0,n[u+2]=d/(e.length-1),n[u+3]=1}var h=new THREE.BufferGeometry;function p(){this.array=null}return h.addAttribute("position",new THREE.BufferAttribute(r,3).onUpload(p)),h.addAttribute("normal",new THREE.BufferAttribute(o,3).onUpload(p)),h.addAttribute("uv",new THREE.BufferAttribute(n,2).onUpload(p)),h.addAttribute("velocity",new THREE.BufferAttribute(a,3).onUpload(p)),h.computeBoundingSphere(),mesh=new THREE.Mesh(h,drawMaterial),mesh.drawMode=THREE[drawMode],mesh}function checkForShake(){accelerationArray.push(acceleration.length());var e=accelerationArray.length;if(e>MINIMIM_ERASE_ENERGY_FRAMES){for(var t=0,r=0;r<e;r++)t+=accelerationArray[r];t>MINIMIM_ERASE_ENERGY*MINIMIM_ERASE_ENERGY_FRAMES?(accelerationArray.length=0,clearLastStroke()):accelerationArray.shift()}}function clearStrokes(){drawing=!1,stroke.length=0,strokeIndex=0;for(var e=strokes.length,t=0;t<e;t++)scene.remove(strokes[t])}function clearLastStroke(){drawing&&(drawing=!1,scene.remove(strokes[strokeIndex]),stroke.length=0),strokeIndex-=1,scene.remove(strokes[strokeIndex])}function updatePhysics(){previousPosition.copy(position),previousNormal.copy(normal),previousNormalQuat.copy(normalQuat),previousVelocity.copy(velocity),getDrawPoint(position),position.lerpVectors(previousPosition,position,STROKE_POSITION_EASING),normalQuat.slerp(camera.quaternion,STROKE_NORMAL_QUAT_EASING),normal.set(0,0,1),normal.applyQuaternion(normalQuat),normal.normalize(),normal.lerpVectors(previousNormal,normal,STROKE_NORMAL_EASING),velocity.subVectors(position,previousPosition),velocity.lerpVectors(previousVelocity,velocity,STROKE_VELOCITY_EASING),acceleration.subVectors(velocity,previousVelocity),strokeWidth=THREE.Math.lerp(strokeWidth,velocity.length()*STROKE_WIDTH_MODIFIER,STROKE_WIDTH_EASING),strokeWidth=Math.min(Math.max(strokeWidth,STROKE_WIDTH_MINIMUM),STROKE_WIDTH_MAXIMUM)}function update(){renderer.clearColor(),arView.render(),camera.updateProjectionMatrix(),vrControls.update(),updatePhysics(),updateAllParticles(getStroke().position),checkForShake(),drawing&&processDraw(),processAllDots(),renderer.clearDepth(),renderer.render(scene,camera),vrDisplay.requestAnimationFrame(update)}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}</script> </body> </html>